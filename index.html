<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idle Gangster</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #1e1e1e;
            color: white;
            background-image: url('https://raw.githubusercontent.com/Nuxium/JamieGangster/main/75F5C3D2-11F9-46CE-AB15-360E207B18E5.jpeg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        #overlay {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 50px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
        }
        #stats {
            margin-top: 20px;
            background: rgba(51, 51, 51, 0.9);
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
        }
        .button-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        .icon-button {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #b22222;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 10px;
            transition: background 0.3s;
        }
        .icon-button:hover {
            background: #ff0000;
        }
        .icon-button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        #crime-section, #contraband-section, #car-theft-section {
            margin-top: 20px;
            display: none;
        }
        .crime-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .crime-card {
            background: rgba(68, 68, 68, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            width: 80%;
            text-align: left;
        }
        .crime-card h4 {
            margin: 0;
        }
        .crime-card p {
            margin: 5px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(68, 68, 68, 0.9);
            margin-top: 10px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #666;
            text-align: center;
        }
        button {
            margin-top: 5px;
            padding: 5px;
            cursor: pointer;
        }
        input[type="number"] {
            width: 50px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #666;
            background: #333;
            color: white;
        }
        #message {
            margin-top: 20px;
            padding: 10px;
            background-color: rgba(51, 51, 51, 0.9);
            color: white;
            border-radius: 5px;
            display: none;
        }
        #contraband-section table {
            display: inline-block;
            margin-right: 20px; /* Espace entre les tableaux */
        }
        .error {
            color: red;
        }
        .cooldown {
            font-size: 12px;
            color: #ff9900;
            margin-top: 5px;
        }
        .timer-display {
            background: rgba(51, 51, 51, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: inline-block;
        }
        h1 {
            text-shadow: 2px 2px 4px #000000;
        }
    </style>
</head>
<body>
    <div id="overlay">
        <h1>Idle Gangster</h1>
        <p>Gravis les rangs et deviens le plus grand gangster !</p>
        <div id="stats">
            <p>Argent: <span id="argent">100</span></p>
            <p>Rang: <span id="rank">Outsider</span></p>
            <p>Nouveau venu, pas encore intégré dans l'organisation, mais cherchant à prouver sa valeur.</p>
            <p id="prison-timer" style="display: none;">Actuellement en prison pendant encore : <span id="prison-time">0s</span></p>
            <div id="cooldown-timers">
                <p id="crime-timer" style="display: none;" class="cooldown">Cooldown Crimes: <span id="crime-cooldown">0s</span></p>
                <p id="car-theft-timer" style="display: none;" class="cooldown">Cooldown Vol de voiture: <span id="car-theft-cooldown">0s</span></p>
            </div>
        </div>
        
        <div class="button-container">
            <button class="icon-button" id="crime-btn">Crimes</button>
            <button class="icon-button" id="car-theft-btn">Vol de voiture</button>
            <button class="icon-button" id="contraband-btn">Contrebande</button>
        </div>

        <div id="message"></div>

        <div id="crime-section" class="crime-container">
            <h3>Crimes</h3>
            <div class="timer-display" id="crime-cooldown-display" style="display: none;">
                En cooldown: <span id="crime-cooldown-value">0</span>s
            </div>
            <div class="crime-card">
                <h4>Petits larcins</h4>
                <p>Réalisez des vols à l'étalage ou des cambriolages de petite envergure.</p>
                <button class="icon-button crime-action" data-crime="petits-larcins" data-chance="0.8">Go</button>
            </div>
            <div class="crime-card">
                <h4>Cambriolages de résidences</h4>
                <p>Pénétrez par effraction dans des maisons pour dérober des objets de valeur.</p>
                <button class="icon-button crime-action" data-crime="cambriolages-de-résidences" data-chance="0.6">Go</button>
            </div>
            <div class="crime-card">
                <h4>Braquages de commerces</h4>
                <p>Attaquez des magasins ou des stations-service pour obtenir de l'argent liquide.</p>
                <button class="icon-button crime-action" data-crime="braquages-de-commerces" data-chance="0.4">Go</button>
            </div>
            <div class="crime-card">
                <h4>Attaques de convois</h4>
                <p>Interceptez des véhicules transportant des marchandises précieuses ou de l'argent.</p>
                <button class="icon-button crime-action" data-crime="attaques-de-convois" data-chance="0.3">Go</button>
            </div>
        </div>
        
        <div id="car-theft-section" class="crime-container">
            <h3>Vol de voiture</h3>
            <div class="timer-display" id="car-theft-cooldown-display" style="display: none;">
                En cooldown: <span id="car-theft-cooldown-value">0</span>s
            </div>
            <div class="crime-card">
                <h4>Vol express</h4>
                <p>Tu repères une voiture mal garée avec la clé sur le contact. En un instant, tu démarres et disparais.</p>
                <button class="icon-button car-theft-action" data-crime="vol-express" data-chance="0.8">Go</button>
            </div>
            <div class="crime-card">
                <h4>Effraction discrète</h4>
                <p>Avec un tournevis et un peu d'huile de coude, tu crochettes la serrure et démarres la voiture sans alerter personne.</p>
                <button class="icon-button car-theft-action" data-crime="effraction-discrète" data-chance="0.6">Go</button>
            </div>
            <div class="crime-card">
                <h4>Carjacking</h4>
                <p>Tu attends que le conducteur sorte de sa voiture et, sous la menace, tu prends les commandes avant de t'enfuir.</p>
                <button class="icon-button car-theft-action" data-crime="carjacking" data-chance="0.4">Go</button>
            </div>
            <div class="crime-card">
                <h4>Vol sous haute sécurité</h4>
                <p>Tu t'attaques à un véhicule de luxe équipé d'un système d'alarme et d'un tracker. Il va falloir être rapide et malin !</p>
                <button class="icon-button car-theft-action" data-crime="vol-sous-haute-sécurité" data-chance="0.3">Go</button>
            </div>
        </div>

        <div id="contraband-section">
            <h3>Contrebande - Alcool et Drogue</h3>
            <div style="display: flex;">
                <table>
                    <tr><th>Produit</th><th>Prix</th><th>Possédé</th><th>Quantité</th><th>Acheter</th><th>Vendre</th></tr>
                    <tr>
                        <td>Vin</td>
                        <td>30</td>
                        <td id="vin-owned">0</td>
                        <td><input type="number" id="vin-quantity" value="1" min="1"></td>
                        <td><button class="buy-btn" data-type="Vin" data-price="30">Acheter</button></td>
                        <td><button class="sell-btn" data-type="Vin" data-price="30">Vendre</button></td>
                    </tr>
                    <tr>
                        <td>Cognac</td>
                        <td>50</td>
                        <td id="cognac-owned">0</td>
                        <td><input type="number" id="cognac-quantity" value="1" min="1"></td>
                        <td><button class="buy-btn" data-type="Cognac" data-price="50">Acheter</button></td>
                        <td><button class="sell-btn" data-type="Cognac" data-price="50">Vendre</button></td>
                    </tr>
                    <tr>
                        <td>Cocaine</td>
                        <td>200</td>
                        <td id="cocaine-owned">0</td>
                        <td><input type="number" id="cocaine-quantity" value="1" min="1"></td>
                        <td><button class="buy-btn" data-type="Cocaine" data-price="200">Acheter</button></td>
                        <td><button class="sell-btn" data-type="Cocaine" data-price="200">Vendre</button></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <script>
        const game = {
            argent: 100,
            rank: "Outsider",
            prisonTime: 0,
            crimeCooldown: 0,       // Cooldown timer for crimes in seconds (1 minute)
            carTheftCooldown: 0,    // Cooldown timer for car thefts in seconds (5 minutes)
            contraband: { Vin: 0, Cognac: 0, Cocaine: 0 },
            totalTransactions: 0,   // Total number of transactions (buy/sell)

            init() {
                console.log("Initializing game...");
                document.getElementById("contraband-btn").addEventListener("click", () => this.toggleSection("contraband-section"));
                document.getElementById("crime-btn").addEventListener("click", () => this.toggleSection("crime-section"));
                document.getElementById("car-theft-btn").addEventListener("click", () => this.toggleSection("car-theft-section"));
                document.querySelectorAll('.buy-btn').forEach(button => {
                    button.addEventListener('click', (e) => this.buyContraband(e.target.dataset.type, parseInt(e.target.dataset.price)));
                });
                document.querySelectorAll('.sell-btn').forEach(button => {
                    button.addEventListener('click', (e) => this.sellContraband(e.target.dataset.type, parseInt(e.target.dataset.price)));
                });
                document.querySelectorAll('.crime-action').forEach(button => {
                    button.addEventListener('click', (e) => this.attemptCrime(e.target.dataset.crime, parseFloat(e.target.dataset.chance)));
                });
                document.querySelectorAll('.car-theft-action').forEach(button => {
                    button.addEventListener('click', (e) => this.attemptCarTheft(e.target.dataset.crime, parseFloat(e.target.dataset.chance)));
                });
                this.updateUI();
                this.startTimers();
            },

            toggleSection(sectionId) {
                console.log(`Toggling section: ${sectionId}`);
                const sections = ["crime-section", "contraband-section", "car-theft-section"];
                sections.forEach(id => {
                    const section = document.getElementById(id);
                    if (id === sectionId) {
                        section.style.display = section.style.display === "block" ? "none" : "block";
                    } else {
                        section.style.display = "none";
                    }
                });
            },

            attemptCrime(crime, chance) {
                console.log(`Attempting crime: ${crime} with chance: ${chance}`);
                if (this.prisonTime > 0) {
                    this.showMessage("Vous êtes en prison, vous ne pouvez pas commettre de crime.", true);
                    return;
                }
                if (this.crimeCooldown > 0) {
                    this.showMessage(`Tu dois attendre encore ${this.crimeCooldown} secondes avant de commettre un nouveau crime.`, true);
                    return;
                }
                const successChance = chance * (1 - (this.rank * 0.05));
                if (Math.random() < successChance) {
                    this.prisonTime = 30;
                    this.showMessage(`Les flics t'ont choppé lors de ${crime} !`);
                    this.updateUI();
                    this.prisonCountdown();
                } else {
                    const reward = this.getCrimeReward(crime);
                    this.argent += reward;
                    this.showMessage(`${crime} réussi ! Vous avez gagné ${reward}$.`);
                }
                this.crimeCooldown = 60; // Set cooldown to 60 seconds (1 minute)
                this.updateUI();
            },

            attemptCarTheft(crime, chance) {
                console.log(`Attempting car theft: ${crime} with chance: ${chance}`);
                if (this.prisonTime > 0) {
                    this.showMessage("Vous êtes en prison, vous ne pouvez pas commettre de crime.", true);
                    return;
                }
                if (this.carTheftCooldown > 0) {
                    this.showMessage(`Tu dois attendre encore ${this.carTheftCooldown} secondes avant de voler une autre voiture.`, true);
                    return;
                }
                const successChance = chance * (1 - (this.rank * 0.05));
                if (Math.random() < successChance) {
                    this.prisonTime = 30;
                    this.showMessage(`Les flics t'ont choppé lors de ${crime} !`);
                    this.updateUI();
                    this.prisonCountdown();
                } else {
                    const reward = this.getCarTheftReward(crime);
                    this.argent += reward;
                    this.showMessage(`${crime} réussi ! Vous avez gagné ${reward}$.`);
                }
                this.carTheftCooldown = 300; // Set cooldown to 300 seconds (5 minutes)
                this.updateUI();
            },

            getCrimeReward(crime) {
                switch (crime) {
                    case 'petits-larcins': return 30;
                    case 'cambriolages-de-résidences': return 100;
                    case 'braquages-de-commerces': return 200;
                    case 'attaques-de-convois': return 300;
                    default: return 0;
                }
            },

            getCarTheftReward(crime) {
                switch (crime) {
                    case 'vol-express': return 50;
                    case 'effraction-discrète': return 150;
                    case 'carjacking': return 300;
                    case 'vol-sous-haute-sécurité': return 500;
                    default: return 0;
                }
            },

            buyContraband(type, price) {
                console.log(`Buying contraband: ${type} for price: ${price}`);
                if (this.prisonTime > 0) return;
                const quantityInput = document.getElementById(`${type.toLowerCase()}-quantity`);
                if (!quantityInput) {
                    this.showMessage(`Erreur: champ de quantité pour ${type} introuvable.`, true);
                    return;
                }

                const quantity = parseInt(quantityInput.value);
                const totalCost = price * quantity;

                if (this.argent >= totalCost) {
                    this.argent -= totalCost;
                    this.contraband[type] += quantity;
                    this.totalTransactions += 1; // Increase transaction count
                    this.checkPrisonChance();
                    this.showMessage(`Vous avez acheté ${quantity} ${type}.`);
                    this.updateUI();
                } else {
                    this.showMessage(`Pas assez de fric pour acheter ce ${type}.`, true);
                }
            },

            sellContraband(type, price) {
                console.log(`Selling contraband: ${type} for price: ${price}`);
                if (this.prisonTime > 0) return;
                const quantityInput = document.getElementById(`${type.toLowerCase()}-quantity`);
                if (!quantityInput) {
                    this.showMessage(`Erreur: champ de quantité pour ${type} introuvable.`, true);
                    return;
                }

                const quantity = parseInt(quantityInput.value);
                if (this.contraband[type] >= quantity) {
                    this.contraband[type] -= quantity;
                    this.argent += price * quantity;
                    this.totalTransactions += 1; // Increase transaction count
                    this.checkPrisonChance();
                    this.showMessage(`Vous avez vendu ${quantity} ${type}.`);
                    this.updateUI();
                } else {
                    this.showMessage("Pas assez de produit pour vendre !", true);
                }
            },

            checkPrisonChance() {
                console.log("Checking prison chance...");
                const baseChance = 0.3; // Base chance of getting caught
                const transactionFactor = 0.02; // Decrease chance per transaction
                const minChance = 0.05; // Minimum chance of getting caught

                let currentChance = baseChance - (this.totalTransactions * transactionFactor);
                currentChance = Math.max(currentChance, minChance); // Ensure it doesn't go below minChance

                if (Math.random() < currentChance) {
                    this.prisonTime = 30;
                    this.showMessage("Les flics t'ont choppé lors de la transaction !");
                    this.updateUI();
                    this.prisonCountdown();
                }
            },

            prisonCountdown() {
                console.log("Starting prison countdown...");
                // Prison countdown is handled in the startTimers method
            },

            startTimers() {
                console.log("Starting all timers...");
                // Single interval to handle all timers
                setInterval(() => {
                    // Prison timer
                    if (this.prisonTime > 0) {
                        this.prisonTime--;
                    }
                    
                    // Crime cooldown timer
                    if (this.crimeCooldown > 0) {
                        this.crimeCooldown--;
                    }
                    
                    // Car theft cooldown timer
                    if (this.carTheftCooldown > 0) {
                        this.carTheftCooldown--;
                    }
                    
                    this.updateUI();
                }, 1000);
            },

            showMessage(message, isError = false) {
                console.log(`Showing message: ${message}`);
                const messageElement = document.getElementById("message");
                messageElement.textContent = message;
                messageElement.className = isError ? 'error' : '';
                messageElement.style.display = "block";
                setTimeout(() => {
                    messageElement.style.display = "none";
                    messageElement.className = ''; // Reset class to avoid persisting error styles
                }, 3000);
            },

            updateUI() {
                // Update basic stats
                document.getElementById("argent").textContent = this.argent;
                document.getElementById("rank").textContent = this.rank;
                
                // Update prison timer
                document.getElementById("prison-time").textContent = `${this.prisonTime}s`;
                document.getElementById("prison-timer").style.display = this.prisonTime > 0 ? "block" : "none";
                
                // Update crime cooldown timer in stats
                document.getElementById("crime-cooldown").textContent = `${this.crimeCooldown}s`;
                document.getElementById("crime-timer").style.display = this.crimeCooldown > 0 ? "block" : "none";
                
                // Update car theft cooldown timer in stats
                document.getElementById("car-theft-cooldown").textContent = `${this.carTheftCooldown}s`;
                document.getElementById("car-theft-timer").style.display = this.carTheftCooldown > 0 ? "block" : "none";
                
                // Update crime section cooldown display
                document.getElementById("crime-cooldown-value").textContent = this.crimeCooldown;
                document.getElementById("crime-cooldown-display").style.display = this.crimeCooldown > 0 ? "block" : "none";
                
                // Update car theft section cooldown display
                document.getElementById("car-theft-cooldown-value").textContent = this.carTheftCooldown;
                document.getElementById("car-theft-cooldown-display").style.display = this.carTheftCooldown > 0 ? "block" : "none";
                
                // Disable/enable crime buttons based on cooldown
                const crimeButtons = document.querySelectorAll('.crime-action');
                crimeButtons.forEach(button => {
                    button.disabled = this.crimeCooldown > 0 || this.prisonTime > 0;
                });
                
                // Disable/enable car theft buttons based on cooldown
                const carTheftButtons = document.querySelectorAll('.car-theft-action');
                carTheftButtons.forEach(button => {
                    button.disabled = this.carTheftCooldown > 0 || this.prisonTime > 0;
                });
                
                // Disable/enable contraband buttons if in prison
                const contrabandButtons = document.querySelectorAll('.buy-btn, .sell-btn');
                contrabandButtons.forEach(button => {
                    button.disabled = this.prisonTime > 0;
                });
                
                // Update contraband quantities
                for (const type in this.contraband) {
                    const element = document.getElementById(`${type.toLowerCase()}-owned`);
                    if (element) {
                        element.textContent = this.contraband[type];
                    }
                }
            }
        };

        // Initialize the game when the page is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM loaded, initializing game...");
            game.init();
        });
    </script>
</body>
</html>
